<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Usuarios | Gestus</title>
    <link rel="stylesheet" href="..//static/css/usuarios.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
    <h2>SST-AnalyTIC</h2>
    <ul>
        <li><a href="/dashboard" class="menu-link">Inicio</a></li>

        <li class="section-title">GESTIÓN PRINCIPAL</li>
        <li><a href="/capacitaciones" class="menu-link">Capacitaciones</a></li>
        <li><a href="/evaluaciones_medicas" class="menu-link">Evaluaciones Médicas</a></li>
        <li><a href="/control_epp" class="menu-link">Gestión EPP</a></li>
        <li><a href="/normas_legales" class="menu-link">Normas Legales</a></li>
        <li><a href="/firma_digital" class="menu-link">Firma Digital</a></li>
        <li><a href="/solicitudes_contrasena" class="menu-link">Solicitudes Contraseña</a></li>

        <li class="section-title">ADMINISTRACIÓN</li>
        <li><a href="/empresas" class="menu-link">Empresas</a></li>
        <li><a href="/usuarios" class="menu-link">Usuarios</a></li>
        <li><a href="/formatos_globales" class="menu-link">Formatos Globales</a></li>
        <li><a href="/documentacion" class="menu-link">Documentación</a></li>

        <li class="section-title">GESTIÓN DE PERSONAL</li>
        <li><a href="/planes_accion" class="menu-link">Planes de Acción</a></li>
        <li><a href="/incidentes_accidentes" class="menu-link">Incidentes y Accidentes</a></li>
        <li><a href="/historial_cambios" class="menu-link">Historial de Cambios</a></li>
      
    </ul>
</div>


    <header class="bg-primary text-white py-3">
        <div class="container">
            <h1 class="h2">Listado de Usuarios</h1>
        </div>
    </header>

    <main class="container my-4">
        <section aria-labelledby="filtros-titulo">
            <h2 id="filtros-titulo" class="visually-hidden">Filtros de búsqueda</h2>
            <form method="get" class="row g-3 mb-4">
                <div class="col-md-4">
                    <label for="nombre" class="form-label">Nombre</label>
                    <input type="search" id="nombre" name="nombre" class="form-control" 
                           placeholder="Buscar por nombre" value="{{ search_params.nombre }}"
                           aria-label="Buscar usuarios por nombre">
                </div>
                
                <div class="col-md-4">
                    <label for="usuario" class="form-label">Usuario</label>
                    <input type="search" id="usuario" name="usuario" class="form-control"
                           placeholder="Buscar por usuario" value="{{ search_params.usuario }}"
                           aria-label="Buscar usuarios por nombre de usuario">
                </div>
                
                <div class="col-md-2">
                    <label for="rol" class="form-label">Rol</label>
                    <select id="rol" name="rol" class="form-select" aria-label="Filtrar por rol">
                        <option value="">Todos los roles</option>
                        {% for rol in roles %}
                        <option value="{{ rol }}" {% if search_params.rol == rol %}selected{% endif %}>{{ rol }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-2">
                    <label for="estado" class="form-label">Estado</label>
                    <select id="estado" name="estado" class="form-select" aria-label="Filtrar por estado">
                        <option value="">Todos</option>
                        {% for estado in estados %}
                        <option value="{{ estado }}" {% if search_params.estado == estado %}selected{% endif %}>{{ estado }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-12 d-flex justify-content-end gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-funnel"></i> Filtrar
                    </button>
                    <a href="{{ url_for('usuarios.lista_usuarios') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-counterclockwise"></i> Limpiar
                    </a>
                </div>
            </form>
        </section>

        <section aria-labelledby="usuarios-titulo">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 id="usuarios-titulo" class="h4">Usuarios registrados</h2>
                <a href="{{ url_for('auth.registrarse') }}" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Nuevo Usuario
                </a>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover" aria-describedby="usuarios-titulo">
                    <caption class="visually-hidden">Listado de usuarios del sistema</caption>
                    <thead class="table-light">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Nombre Completo</th>
                            <th scope="col">Usuario</th>
                            <th scope="col">Correo</th>
                            <th scope="col">Rol</th>
                            <th scope="col">Empresa</th>
                            <th scope="col">Estado</th>
                            <th scope="col" class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for usuario in usuarios %}
                        <tr>
                            <th scope="row">{{ usuario.id_usuario }}</th>
                            <td>{{ usuario.nombre_completo }}</td>
                            <td>{{ usuario.usuario }}</td>
                            <td><a href="mailto:{{ usuario.correo }}">{{ usuario.correo }}</a></td>
                            <td>{{ usuario.rol_nombre or 'N/A' }}</td>
                            <td>{{ usuario.empresa_nombre or 'N/A' }}</td>
                            <td>
                                <span class="badge rounded-pill {% if usuario.estado == 'Activo' %}bg-success{% else %}bg-secondary{% endif %}">
                                    {{ usuario.estado }}
                                </span>
                            </td>
                            <td class="text-end">
                                <div class="btn-group" role="group" aria-label="Acciones para usuario {{ usuario.id_usuario }}">
                                    <a href="{{ url_for('usuarios.editar_usuario', id=usuario.id_usuario) }}" 
                                       class="btn btn-sm btn-outline-primary"
                                       aria-label="Editar usuario {{ usuario.nombre_completo }}">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    {% if usuario.estado == 'Activo' %}
                                    <a href="{{ url_for('usuarios.lista_usuarios', id=usuario.id_usuario) }}" 
                                       class="btn btn-sm btn-outline-danger"
                                       aria-label="Desactivar usuario {{ usuario.nombre_completo }}">
                                        <i class="bi bi-person-x"></i>
                                    </a>
                                    {% else %}
                                    <a href="{{ url_for('usuarios.lista_usuarios', id=usuario.id_usuario) }}" 
                                       class="btn btn-sm btn-outline-success"
                                       aria-label="Activar usuario {{ usuario.nombre_completo }}">
                                        <i class="bi bi-person-check"></i>
                                    </a>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center py-4">
                                <div class="alert alert-info" role="alert">
                                    No se encontraron usuarios con los filtros actuales
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer class="bg-light py-3 mt-4">
        <div class="container text-center text-muted">
            <small>Sistema de Gestión de Seguridad - Gestus SG</small>
        </div>
    </footer>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
